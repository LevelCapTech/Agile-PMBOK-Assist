import"./index-BBR7LY95.js";import{r as n,o as e,w as A,B as M}from"./chunk-JZWAC4HX-B6x1WFhp.js";import{c as R,R as T}from"./createLucideIcon-CX3imBzu.js";import{_ as C}from"./style-BLPlDJLg.js";import{R as P}from"./react-markdown-DAl-9aKu.js";import{w as $}from"./withBase-CShqtCaV.js";import{A as I}from"./arrow-left-Cm6uM9zz.js";import{S as L,a as z,U as O,B as b,b as D}from"./user-C1OvlLCx.js";import{E as K}from"./eye-D-03m7lB.js";import"./index-iCDPYYrY.js";if(typeof window<"u"){const a={};globalThis.process??={};const o=globalThis.process.env??{};globalThis.process.env=new Proxy(Object.assign({},a,o),{get(t,r){return r in t?t[r]:void 0},has(){return!0}})}const J=R("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);if(typeof window<"u"){const a={};globalThis.process??={};const o=globalThis.process.env??{};globalThis.process.env=new Proxy(Object.assign({},a,o),{get(t,r){return r in t?t[r]:void 0},has(){return!0}})}function U({onChunk:a,onFinish:o}){const t=n.useCallback(async i=>{if(i.body){const h=i.body.getReader();if(h){const c=new TextDecoder;let d="";for(;;){const{done:x,value:f}=await h.read();if(x){o(d);break}const m=c.decode(f,{stream:!0});d+=m,a(d)}}}},[a,o]),r=n.useRef(t);return n.useEffect(()=>{r.current=t},[t]),n.useCallback(i=>r.current(i),[])}if(typeof window<"u"){const a={};globalThis.process??={};const o=globalThis.process.env??{};globalThis.process.env=new Proxy(Object.assign({},a,o),{get(t,r){return r in t?t[r]:void 0},has(){return!0}})}function V({params:a}){const o=a.id,[t,r]=n.useState([{role:"assistant",content:"こんにちは！新しいプロジェクトフェーズの作成をお手伝いします。どのようなフェーズを作成したいですか？"}]),[i,h]=n.useState(""),[c,d]=n.useState(""),[x,f]=n.useState(!1),[m,u]=n.useState(`# 新しいフェーズ

## 概要
このフェーズの目的と概要を記載してください。

## 成果物
- 成果物1
- 成果物2

## タスク
1. タスク1
2. タスク2

## 期間
- 開始日: 未定
- 終了日: 未定

## 担当者
- 担当者名を記載
`),[j,g]=n.useState("edit"),w=n.useRef(null),N=n.useRef(null),y=()=>{w.current?.scrollIntoView({behavior:"smooth"})};n.useEffect(()=>{y()},[t,c]);const F=n.useCallback(s=>{if(r(l=>[...l,{role:"assistant",content:s}]),d(""),f(!1),s.includes("```markdown")||s.includes("# ")){const l=s.match(/```markdown\n([\s\S]*?)\n```/);l?u(l[1]):s.startsWith("# ")&&u(s)}},[]),k=U({onChunk:d,onFinish:F}),v=async()=>{if(!i.trim()||x)return;const s={role:"user",content:i};r(l=>[...l,s]),h(""),f(!0);try{const l={role:"system",content:`あなたはプロジェクトフェーズの作成を支援するアシスタントです。ユーザーの要求に応じて、Markdown形式でフェーズの詳細を作成してください。現在のMarkdownコンテンツ:

${m}

Markdownコードブロック（\`\`\`markdown）で囲んで出力してください。`},p=await fetch("/integrations/chat-gpt/conversationgpt4",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[l,...t,s],stream:!0})});if(!p.ok)throw new Error("Failed to get AI response");k(p)}catch(l){console.error("Error sending message:",l),r(p=>[...p,{role:"assistant",content:"申し訳ありません。エラーが発生しました。もう一度お試しください。"}]),f(!1)}},E=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),v())},B=async()=>{console.log("Saving phase:",m),alert("フェーズを保存しました（実装予定）")},S=()=>{window.location.href=$(`/projects/${o}`)};return e.jsxs("div",{className:"jsx-2591647826 min-h-screen bg-white font-inter flex flex-col",children:[e.jsx("div",{className:"jsx-2591647826 bg-white border-b border-[#E6E8EB] px-8 py-4",children:e.jsxs("div",{className:"jsx-2591647826 flex items-center justify-between",children:[e.jsxs("div",{className:"jsx-2591647826 flex items-center space-x-4",children:[e.jsxs("button",{onClick:S,className:"jsx-2591647826 flex items-center space-x-2 text-[#8A8F99] hover:text-[#246BFF] transition-colors",children:[e.jsx(I,{className:"w-4 h-4"}),e.jsx("span",{className:"jsx-2591647826 text-sm font-normal",children:"プロジェクトに戻る"})]}),e.jsx("div",{className:"jsx-2591647826 h-4 w-px bg-[#E6E8EB]"}),e.jsx("h1",{className:"jsx-2591647826 text-lg font-semibold text-black",children:"新しいフェーズを作成"})]}),e.jsxs("button",{onClick:B,className:"jsx-2591647826 flex items-center space-x-2 px-4 py-2 bg-[#246BFF] text-white rounded-2xl hover:bg-[#1B59E0] transition-colors",children:[e.jsx(L,{className:"w-4 h-4"}),e.jsx("span",{className:"jsx-2591647826 text-xs font-semibold",children:"保存"})]})]})}),e.jsxs("div",{className:"jsx-2591647826 flex-1 flex overflow-hidden",children:[e.jsxs("div",{className:"jsx-2591647826 w-1/2 border-r border-[#E6E8EB] flex flex-col",children:[e.jsxs("div",{className:"jsx-2591647826 px-6 py-4 border-b border-[#E6E8EB]",children:[e.jsxs("div",{className:"jsx-2591647826 flex items-center space-x-2",children:[e.jsx(z,{className:"w-5 h-5 text-[#246BFF]"}),e.jsx("h2",{className:"jsx-2591647826 text-base font-semibold text-black",children:"AI アシスタント"})]}),e.jsx("p",{className:"jsx-2591647826 text-xs text-[#8A8F99] mt-1",children:"フェーズの内容をAIと対話しながら編集できます"})]}),e.jsxs("div",{ref:N,className:"jsx-2591647826 flex-1 overflow-y-auto px-6 py-4 space-y-4",children:[t.map((s,l)=>e.jsx("div",{className:`jsx-2591647826 flex ${s.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`jsx-2591647826 flex items-start space-x-3 max-w-[80%] ${s.role==="user"?"flex-row-reverse space-x-reverse":""}`,children:[e.jsx("div",{className:`jsx-2591647826 w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${s.role==="user"?"bg-[#246BFF]":"bg-[#F3F4F6]"}`,children:s.role==="user"?e.jsx(O,{className:"w-4 h-4 text-white"}):e.jsx(b,{className:"w-4 h-4 text-[#8A8F99]"})}),e.jsx("div",{className:`jsx-2591647826 px-4 py-3 rounded-2xl ${s.role==="user"?"bg-[#246BFF] text-white":"bg-[#F9FAFB] text-black"}`,children:e.jsx("div",{className:"jsx-2591647826 text-sm whitespace-pre-wrap break-words",children:s.content})})]})},l)),c&&e.jsx("div",{className:"jsx-2591647826 flex justify-start",children:e.jsxs("div",{className:"jsx-2591647826 flex items-start space-x-3 max-w-[80%]",children:[e.jsx("div",{className:"jsx-2591647826 w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 bg-[#F3F4F6]",children:e.jsx(b,{className:"w-4 h-4 text-[#8A8F99]"})}),e.jsx("div",{className:"jsx-2591647826 px-4 py-3 rounded-2xl bg-[#F9FAFB] text-black",children:e.jsx("div",{className:"jsx-2591647826 text-sm whitespace-pre-wrap break-words",children:c})})]})}),x&&!c&&e.jsx("div",{className:"jsx-2591647826 flex justify-start",children:e.jsxs("div",{className:"jsx-2591647826 flex items-start space-x-3",children:[e.jsx("div",{className:"jsx-2591647826 w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 bg-[#F3F4F6]",children:e.jsx(b,{className:"w-4 h-4 text-[#8A8F99]"})}),e.jsx("div",{className:"jsx-2591647826 px-4 py-3 rounded-2xl bg-[#F9FAFB]",children:e.jsxs("div",{className:"jsx-2591647826 flex space-x-1",children:[e.jsx("div",{className:"jsx-2591647826 w-2 h-2 bg-[#8A8F99] rounded-full animate-bounce"}),e.jsx("div",{style:{animationDelay:"0.1s"},className:"jsx-2591647826 w-2 h-2 bg-[#8A8F99] rounded-full animate-bounce"}),e.jsx("div",{style:{animationDelay:"0.2s"},className:"jsx-2591647826 w-2 h-2 bg-[#8A8F99] rounded-full animate-bounce"})]})})]})}),e.jsx("div",{ref:w,className:"jsx-2591647826"})]}),e.jsx("div",{className:"jsx-2591647826 px-6 py-4 border-t border-[#E6E8EB]",children:e.jsxs("div",{className:"jsx-2591647826 flex items-end space-x-3",children:[e.jsx("textarea",{value:i,onChange:s=>h(s.target.value),onKeyPress:E,placeholder:"メッセージを入力...",rows:1,disabled:x,className:"jsx-2591647826 flex-1 px-4 py-3 border border-[#E6E8EB] rounded-2xl text-sm resize-none focus:outline-none focus:border-[#246BFF] min-h-[48px] max-h-[120px]"}),e.jsx("button",{onClick:v,disabled:!i.trim()||x,className:"jsx-2591647826 px-4 py-3 bg-[#246BFF] text-white rounded-2xl hover:bg-[#1B59E0] transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex-shrink-0",children:e.jsx(D,{className:"w-4 h-4"})})]})})]}),e.jsxs("div",{className:"jsx-2591647826 w-1/2 flex flex-col",children:[e.jsxs("div",{className:"jsx-2591647826 px-6 py-4 border-b border-[#E6E8EB] flex items-center justify-between",children:[e.jsx("h2",{className:"jsx-2591647826 text-base font-semibold text-black",children:"フェーズドキュメント"}),e.jsxs("div",{className:"jsx-2591647826 flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>g("edit"),className:`jsx-2591647826 px-3 py-2 rounded-lg text-xs font-semibold transition-colors flex items-center space-x-2 ${j==="edit"?"bg-[#246BFF] text-white":"bg-white text-[#8A8F99] border border-[#E6E8EB] hover:bg-[#F9FAFB]"}`,children:[e.jsx(J,{className:"w-4 h-4"}),e.jsx("span",{className:"jsx-2591647826",children:"編集"})]}),e.jsxs("button",{onClick:()=>g("preview"),className:`jsx-2591647826 px-3 py-2 rounded-lg text-xs font-semibold transition-colors flex items-center space-x-2 ${j==="preview"?"bg-[#246BFF] text-white":"bg-white text-[#8A8F99] border border-[#E6E8EB] hover:bg-[#F9FAFB]"}`,children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx("span",{className:"jsx-2591647826",children:"プレビュー"})]})]})]}),e.jsx("div",{className:"jsx-2591647826 flex-1 overflow-hidden",children:j==="edit"?e.jsx("textarea",{value:m,onChange:s=>u(s.target.value),placeholder:"Markdown形式でフェーズの内容を記述...",className:"jsx-2591647826 w-full h-full px-6 py-4 resize-none focus:outline-none text-sm font-mono"}):e.jsx("div",{className:"jsx-2591647826 h-full overflow-y-auto px-6 py-4",children:e.jsx("div",{className:"jsx-2591647826 prose prose-sm max-w-none",children:e.jsx(P,{children:m})})})})]})]}),e.jsx(C,{id:"2591647826",children:[".prose{color:#000;}",".prose h1{font-size:1.875rem;font-weight:600;margin-top:1.5rem;margin-bottom:1rem;color:#000;}",".prose h2{font-size:1.5rem;font-weight:600;margin-top:1.25rem;margin-bottom:0.75rem;color:#000;}",".prose h3{font-size:1.25rem;font-weight:600;margin-top:1rem;margin-bottom:0.5rem;color:#000;}",".prose p{margin-top:0.5rem;margin-bottom:0.5rem;line-height:1.75;}",".prose ul,.prose ol{margin-top:0.5rem;margin-bottom:0.5rem;padding-left:1.5rem;}",".prose li{margin-top:0.25rem;margin-bottom:0.25rem;}",".prose code{background-color:#f3f4f6;padding:0.125rem 0.375rem;border-radius:0.25rem;font-size:0.875em;}",".prose pre{background-color:#f3f4f6;padding:1rem;border-radius:0.5rem;overflow-x:auto;}",".prose pre code{background-color:transparent;padding:0;}",".prose blockquote{border-left:4px solid #246bff;padding-left:1rem;margin-left:0;font-style:italic;color:#6b7280;}",".prose a{color:#246bff;-webkit-text-decoration:underline;text-decoration:underline;}",".prose strong{font-weight:600;}",".prose hr{border-color:#e6e8eb;margin-top:1.5rem;margin-bottom:1.5rem;}"]})]})}if(typeof window<"u"){const a={};globalThis.process??={};const o=globalThis.process.env??{};globalThis.process.env=new Proxy(Object.assign({},a,o),{get(t,r){return r in t?t[r]:void 0},has(){return!0}})}const se=A(function(o){const t=M();return e.jsx(T,{children:e.jsx(V,{...o,id:t.id})})});export{se as default};
