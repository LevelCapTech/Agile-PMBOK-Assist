import"./index-BBR7LY95.js";import{r as o,o as e,w as I,B as $}from"./chunk-JZWAC4HX-B6x1WFhp.js";import{R as D}from"./createLucideIcon-CX3imBzu.js";import{w as B}from"./withBase-IHPMnX3N.js";import{A as K}from"./arrow-left-Cm6uM9zz.js";import{S as R,a as z,U as L,B as _,b as M}from"./user-C1OvlLCx.js";import{C as O}from"./chevron-down-XhQ4_9dy.js";if(typeof window<"u"){const x={};globalThis.process??={};const l=globalThis.process.env??{};globalThis.process.env=new Proxy(Object.assign({},x,l),{get(n,c){return c in n?n[c]:void 0},has(){return!0}})}function q({params:x}){const l=parseInt(x.id),[n,c]=o.useState(!0),[h,u]=o.useState({name:"",code:"",start_date:"",client:"",project_manager:"",end_date:"",purpose:"",expected_outcome:"",target_system:"",development_scope:"",exclusion_scope:"",deliverables:"",organization_chart:"",role_assignment:"",phase_schedule:"",milestones:"",risks:"",countermeasures:"",review_policy:"",test_criteria:"",reporting_rules:""}),[j,b]=o.useState([{role:"assistant",content:"こんにちは！プロジェクトの編集をお手伝いします。どの部分を変更したいか教えてください。例えば、「終了日を1ヶ月延ばしたい」のように話しかけてみてください。"}]),[f,g]=o.useState(""),[p,v]=o.useState(!1),[y,k]=o.useState({basic:!0,purpose:!1,scope:!1,deliverables:!1,organization:!1,schedule:!1,risks:!1,quality:!1}),N=o.useRef(null),S=o.useRef(null);o.useEffect(()=>{(async()=>{try{const t=await fetch(`/api/projects/${l}`);if(!t.ok)throw new Error("Failed to fetch project");const a=await t.json();u(a)}catch(t){console.error("Error fetching project:",t),alert("プロジェクトの読み込みに失敗しました")}finally{c(!1)}})()},[l]);const A=()=>{N.current?.scrollIntoView({behavior:"smooth"})};o.useEffect(()=>{A()},[j]);const P=()=>{window.location.href=B(`/projects/${l}`)},C=s=>{k(t=>({...t,[s]:!t[s]}))},E=(s,t)=>{u(a=>({...a,[s]:t}))},F=async()=>{if(!f.trim()||p)return;const s=f.trim();g(""),v(!0),b(t=>[...t,{role:"user",content:s}]);try{const t=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[...j,{role:"user",content:s}],projectData:h})});if(!t.ok)throw new Error("API request failed");const a=await t.json();b(d=>[...d,{role:"assistant",content:a.message}]),a.updatedProjectData&&u(d=>({...d,...a.updatedProjectData}))}catch(t){console.error("Error sending message:",t),b(a=>[...a,{role:"assistant",content:"申し訳ございません。エラーが発生しました。もう一度お試しください。"}])}finally{v(!1)}},T=async()=>{try{if(!(await fetch(`/api/projects/${l}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)})).ok)throw new Error("Failed to update project");alert("プロジェクトを更新しました！"),window.location.href=B(`/projects/${l}`)}catch(s){console.error("Error saving project:",s),alert("プロジェクトの保存に失敗しました")}},i=({title:s,sectionKey:t,children:a})=>e.jsxs("div",{className:"bg-white border border-[#E6E8EB] rounded-lg mb-3",children:[e.jsxs("button",{onClick:()=>C(t),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-[#F9FAFB] transition-colors",children:[e.jsx("h3",{className:"text-base font-semibold text-black",children:s}),e.jsx(O,{className:`w-5 h-5 text-[#8A8F99] transition-transform ${y[t]?"transform rotate-180":""}`})]}),y[t]&&e.jsx("div",{className:"border-t border-[#E6E8EB] px-6 py-4 space-y-4",children:a})]}),m=({label:s,field:t,type:a="text",placeholder:d=""})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-[#343A40] mb-2",children:s}),e.jsx("input",{type:a,value:h[t],onChange:w=>E(t,w.target.value),placeholder:d,className:"w-full px-4 py-2 text-sm border border-[#E6E8EB] rounded-lg focus:outline-none focus:border-[#246BFF] transition-colors"})]}),r=({label:s,field:t,placeholder:a="",rows:d=4})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-[#343A40] mb-2",children:s}),e.jsx("textarea",{value:h[t],onChange:w=>E(t,w.target.value),placeholder:a,rows:d,className:"w-full px-4 py-2 text-sm border border-[#E6E8EB] rounded-lg focus:outline-none focus:border-[#246BFF] transition-colors resize-none"})]});return n?e.jsx("div",{className:"min-h-screen bg-white font-inter flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-[#246BFF] border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-[#8A8F99]",children:"読み込み中..."})]})}):e.jsxs("div",{className:"min-h-screen bg-white font-inter flex flex-col",children:[e.jsx("div",{className:"bg-white border-b border-[#E6E8EB] px-8 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("button",{onClick:P,className:"flex items-center space-x-2 text-[#8A8F99] hover:text-[#246BFF] transition-colors",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-normal",children:"戻る"})]}),e.jsx("div",{className:"h-6 w-px bg-[#E6E8EB]"}),e.jsx("h1",{className:"text-xl font-semibold text-black",children:"プロジェクト編集"})]}),e.jsxs("button",{onClick:T,className:"flex items-center space-x-2 px-6 py-2 bg-[#246BFF] rounded-2xl hover:bg-[#1B59E0] transition-colors",children:[e.jsx(R,{className:"w-4 h-4 text-white"}),e.jsx("span",{className:"text-sm font-semibold text-white",children:"保存"})]})]})}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsxs("div",{className:"w-1/2 border-r border-[#E6E8EB] flex flex-col",children:[e.jsx("div",{className:"px-6 py-4 border-b border-[#E6E8EB]",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-[#246BFF] to-[#1B59E0] rounded-full flex items-center justify-center",children:e.jsx(z,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-semibold text-black",children:"AIアシスタント"}),e.jsx("p",{className:"text-xs text-[#8A8F99]",children:"プロジェクト編集をサポート"})]})]})}),e.jsxs("div",{ref:S,className:"flex-1 overflow-y-auto px-6 py-4 space-y-4",children:[j.map((s,t)=>e.jsxs("div",{className:`flex items-start space-x-3 ${s.role==="user"?"flex-row-reverse space-x-reverse":""}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${s.role==="user"?"bg-[#E6E8EB]":"bg-gradient-to-br from-[#246BFF] to-[#1B59E0]"}`,children:s.role==="user"?e.jsx(L,{className:"w-4 h-4 text-[#343A40]"}):e.jsx(_,{className:"w-4 h-4 text-white"})}),e.jsx("div",{className:`flex-1 ${s.role==="user"?"text-right":""}`,children:e.jsx("div",{className:`inline-block px-4 py-3 rounded-2xl ${s.role==="user"?"bg-[#246BFF] text-white":"bg-[#F3F4F6] text-black"}`,children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s.content})})})]},t)),p&&e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-[#246BFF] to-[#1B59E0] flex items-center justify-center",children:e.jsx(_,{className:"w-4 h-4 text-white"})}),e.jsx("div",{className:"bg-[#F3F4F6] px-4 py-3 rounded-2xl",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-[#8A8F99] rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-[#8A8F99] rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-[#8A8F99] rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})]}),e.jsx("div",{ref:N})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-[#E6E8EB]",children:[e.jsxs("div",{className:"flex items-end space-x-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx("textarea",{value:f,onChange:s=>g(s.target.value),onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),F())},placeholder:"変更したい内容を教えてください...",rows:3,disabled:p,className:"w-full px-4 py-3 text-sm border border-[#E6E8EB] rounded-xl focus:outline-none focus:border-[#246BFF] transition-colors resize-none"})}),e.jsx("button",{onClick:F,disabled:!f.trim()||p,className:"px-4 py-3 bg-[#246BFF] rounded-xl hover:bg-[#1B59E0] transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(M,{className:"w-5 h-5 text-white"})})]}),e.jsx("p",{className:"text-xs text-[#8A8F99] mt-2",children:"Shift + Enter で改行、Enter で送信"})]})]}),e.jsx("div",{className:"w-1/2 overflow-y-auto",children:e.jsxs("div",{className:"px-6 py-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-black mb-2",children:"プロジェクト情報"}),e.jsx("p",{className:"text-sm text-[#8A8F99]",children:"AIと対話するか、直接入力してプロジェクト情報を編集できます"})]}),e.jsxs(i,{title:"1. 基本情報",sectionKey:"basic",children:[e.jsx(m,{label:"プロジェクト名",field:"name"}),e.jsx(m,{label:"プロジェクトコード",field:"code"}),e.jsx(m,{label:"開始日",field:"start_date",type:"date"}),e.jsx(m,{label:"終了予定日",field:"end_date",type:"date"}),e.jsx(m,{label:"発注元",field:"client"}),e.jsx(m,{label:"プロジェクトマネージャー",field:"project_manager"})]}),e.jsxs(i,{title:"2. 目的と背景",sectionKey:"purpose",children:[e.jsx(r,{label:"なぜこの開発を行うか",field:"purpose",rows:4}),e.jsx(r,{label:"期待する成果",field:"expected_outcome",rows:4})]}),e.jsxs(i,{title:"3. スコープ",sectionKey:"scope",children:[e.jsx(r,{label:"対象システム・業務",field:"target_system",rows:3}),e.jsx(r,{label:"開発範囲",field:"development_scope",rows:3}),e.jsx(r,{label:"除外範囲",field:"exclusion_scope",rows:3})]}),e.jsx(i,{title:"4. 成果物",sectionKey:"deliverables",children:e.jsx(r,{label:"納品するシステム・ドキュメント一覧",field:"deliverables",rows:6})}),e.jsxs(i,{title:"5. 体制・役割分担",sectionKey:"organization",children:[e.jsx(r,{label:"プロジェクト組織図",field:"organization_chart",rows:6}),e.jsx(r,{label:"担当者ごとの役割",field:"role_assignment",rows:4})]}),e.jsxs(i,{title:"6. スケジュール概要",sectionKey:"schedule",children:[e.jsx(r,{label:"フェーズごとの期間",field:"phase_schedule",rows:4}),e.jsx(r,{label:"マイルストーン",field:"milestones",rows:4})]}),e.jsxs(i,{title:"7. リスクと対応方針",sectionKey:"risks",children:[e.jsx(r,{label:"想定リスク",field:"risks",rows:4}),e.jsx(r,{label:"予防策・対応策",field:"countermeasures",rows:4})]}),e.jsxs(i,{title:"8. 品質・進捗管理方法",sectionKey:"quality",children:[e.jsx(r,{label:"レビューの有無",field:"review_policy",rows:3}),e.jsx(r,{label:"テストの基準",field:"test_criteria",rows:3}),e.jsx(r,{label:"日次／週次の報告ルール",field:"reporting_rules",rows:3})]})]})})]})]})}if(typeof window<"u"){const x={};globalThis.process??={};const l=globalThis.process.env??{};globalThis.process.env=new Proxy(Object.assign({},x,l),{get(n,c){return c in n?n[c]:void 0},has(){return!0}})}const X=I(function(l){const n=$();return e.jsx(D,{children:e.jsx(q,{...l,id:n.id})})});export{X as default};
